<!-- backend/app/templates/index.html -->
{% extends "base.html" %} {% block title %}Site Monitor Pro - Dashboard{%
endblock %} {% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %} {% block content %} {% if error %}
<div
  class="mb-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-md"
>
  {{ error }}
  <button
    onclick="this.parentElement.style.display='none'"
    class="float-right font-bold"
  >
    &times;
  </button>
</div>
{% endif %}

<!-- Dashboard Cards - Only show if there are sites -->
{% if sites|length > 0 %}
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
  <div class="bg-white shadow-md rounded-lg p-6 border border-gray-200">
    <h2 class="text-lg font-medium mb-2">Total Sites</h2>
    <p class="text-3xl font-bold">{{ sites|length }}</p>
  </div>

  <div class="bg-white shadow-md rounded-lg p-6 border border-gray-200">
    <h2 class="text-lg font-medium mb-2">Sites Up</h2>
    <p class="text-3xl font-bold text-green-600">{{ sites_up }}</p>
  </div>

  <div class="bg-white shadow-md rounded-lg p-6 border border-gray-200">
    <h2 class="text-lg font-medium mb-2">Sites Down</h2>
    <p class="text-3xl font-bold text-red-600">{{ sites_down }}</p>
  </div>
</div>

<!-- Response Time Chart - Only show if there are sites -->
<div class="bg-white shadow-md rounded-lg p-6 mb-6 border border-gray-200">
  <h3 class="text-lg font-medium mb-4">Response Time Chart</h3>
  <div class="h-80">
    <canvas id="responseTimeChart"></canvas>
  </div>
  <div class="text-xs text-gray-500 text-center mt-4">
    <span class="inline-block px-2 py-1 bg-green-100 rounded mr-2"
      >Fast response</span
    >
    <span class="inline-block px-2 py-1 bg-yellow-100 rounded mr-2"
      >Medium response (&gt;500ms)</span
    >
    <span class="inline-block px-2 py-1 bg-red-100 rounded"
      >Slow response (&gt;1000ms)</span
    >
  </div>
</div>
{% endif %}

<!-- Monitored Sites or Welcome Section -->
<div class="bg-white shadow-md rounded-lg p-6 border border-gray-200">
  <h2 class="text-lg font-medium mb-4">
    {% if sites|length == 0 %}Welcome to Site Monitor Pro{% else %}Monitored
    Sites{% endif %}
  </h2>

  {% if sites|length == 0 %}
  <div class="py-10 text-center">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="mx-auto h-12 w-12 text-gray-400"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="1.5"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
      />
    </svg>
    <h3 class="mt-2 text-lg font-medium text-gray-900">
      Get started with your website monitoring
    </h3>
    <p class="mt-1 text-gray-500">
      Track uptime, response times, and get alerts when your sites go down.
    </p>
    <div class="mt-6">
      <a
        href="{{ url_for('api.add_site') }}"
        class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-gray-900 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          class="-ml-1 mr-2 h-5 w-5"
          viewBox="0 0 20 20"
          fill="currentColor"
        >
          <path
            fill-rule="evenodd"
            d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z"
            clip-rule="evenodd"
          />
        </svg>
        Add Your First Site
      </a>
    </div>
  </div>
  {% else %}
  <div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Name
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            URL
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Status
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Response Time
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Last Checked
          </th>
          <th
            class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
          >
            Actions
          </th>
        </tr>
      </thead>
      <tbody class="bg-white divide-y divide-gray-200">
        {% for site in sites %}
        <tr>
          <td class="px-6 py-4 whitespace-nowrap">{{ site.name }}</td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            {{ site.url }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span
              class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full {% if site.status.startswith('OK') %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}"
            >
              {{ site.status }}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm">
            <span
              class="{% if site.response_time > 1000 %}text-red-600 font-medium{% elif site.response_time > 500 %}text-yellow-600{% else %}text-gray-500{% endif %}"
            >
              {{ site.response_time }} ms {% if site.response_time > 1000 %}
              <span
                class="ml-2 inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800"
                >Slow</span
              >
              {% endif %}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            {{ site.last_checked_formatted if site.last_checked else "Never" }}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
            <a
              href="{{ url_for('api.check_site_route', site_id=site.id) }}"
              class="text-gray-900 hover:text-gray-700 mr-3"
              >Check Now</a
            >
            <a
              href="{{ url_for('api.site_details', site_id=site.id) }}"
              class="text-blue-600 hover:text-blue-800 mr-3"
              >Details</a
            >
            <a
              href="{{ url_for('api.delete_site', site_id=site.id) }}"
              class="text-red-600 hover:text-red-900"
              onclick="return confirm('Are you sure you want to delete this site?')"
              >Delete</a
            >
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}
</div>
{% endblock %} {% block scripts %} {% if sites|length > 0 %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Data for the chart
    const chartData = JSON.parse("{{ chart_data|tojson|safe }}");

    // Get the canvas and create the chart
    const ctx = document.getElementById("responseTimeChart").getContext("2d");
    new Chart(ctx, {
      type: "bar",
      data: {
        labels: chartData.map(function (site) {
          return site.name;
        }),
        datasets: [
          {
            label: "Response Time (ms)",
            data: chartData.map(function (site) {
              return site.response_time;
            }),
            backgroundColor: chartData.map(function (site) {
              if (site.response_time > 1000) {
                return "#EF4444"; // red for slow responses
              } else if (site.response_time > 500) {
                return "#F59E0B"; // amber for medium responses
              } else {
                return "#10B981"; // green for fast responses
              }
            }),
            borderColor: chartData.map(function (site) {
              return site.status.startsWith("OK") ? "" : "#991B1B";
            }),
            borderWidth: chartData.map(function (site) {
              return site.status.startsWith("OK") ? 0 : 2;
            }),
          },
        ],
      },
      options: {
        indexAxis: "y",
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false,
          },
          tooltip: {
            callbacks: {
              afterLabel: function (context) {
                const index = context.dataIndex;
                const site = chartData[index];
                return "Status: " + site.status;
              },
            },
          },
        },
        scales: {
          x: {
            beginAtZero: true,
            grid: {
              display: true,
            },
            title: {
              display: true,
              text: "Response Time (ms)",
            },
            ticks: {
              callback: function (value) {
                return value + " ms";
              },
            },
          },
          y: {
            grid: {
              display: false,
            },
          },
        },
      },
    });
  });
</script>
{% endif %} {% endblock %}
